---
layout:     post
title:      DenseASPP阅读笔记
subtitle:   DenseASPP for Semantic Segmentation in Street Scenes
date:       2019-05-24
author:     Nick
header-img: img/博客背景.jpg
catalog: true
tags:
    - 论文阅读
---

## 摘要：

语义图像分割是自动驾驶中的基本街道场景理解任务，其中高分辨率图像中的每个像素被分类为一组语义标签。与其他场景不同，自动驾驶场景中的对象表现出非常大的尺度变化，这对于场景中的高层特征表示提出了巨大的挑战，多尺度信息必须被正确编码。为了解决这个问题，引入了空洞卷积卷积来生成具有更大感受野的特征而不牺牲空间分辨率。建立在空洞卷积的基础上，ASPP用来串联多个具有不同扩张率的扩张卷积特征来生成最终的特征表示。虽然ASPP能够生成多尺度特征，但是**我们认为尺度轴上的特征分辨率对于自动驾驶场景来说不够密集**。因此，我们提出denseaspp，其将扩张卷积以密集连接的方式进行连接，这样他就可以**生成不仅覆盖更广的范围并且密集的覆盖更广的范围多尺度特征**  ，而不显著增加模型尺寸。我们在街景场景基准Cityscapes上评估DenseASPP并实现最先进的性能。

![HRNet网络结构](C:\Users\CV\Documents\GitHub\niecongchong.github.io\img\2019-05-24-1.png)

## 1. 简介

利用完全卷积网络（FCN），语义图像分割已经取得了有前途的成果，并且显着改进了特征表示。高级语义信息在实现分割网络的高性能方面起着至关重要的作用。为了提取高级信息，FCN使用多个池化层来增加输出神经元的感受野大小。但是，池化层数量的增加会导致特征图尺寸减小，这对将分割输出重新采样回原始分辨率提出了严峻挑战。另一方面，如果我们从具有更大分辨率的早期层输出进行分割，则我们无法使用更高级别的语义来进行更好的推理。

***总结来说就是说出了想要小特征图的高级语义信息，但输出图像糊***

扩张卷积用来解决较大特征图解析与较大感受野之间的矛盾。通过将零插入卷积核掩模中的适当位置，可以以不同的速率扩张卷积核。与传统的卷积运算相比，atrous卷积能够在不增加内核参数数量的情况下实现更大的感受野大小。由atrous卷积产生的特征图可以与输入的大小相同，但是每个输出神经元具有更大的感受野，因此可以编码更高级别的语义。

***总结来说就是扩张卷积可以不损失分辨率的情况下有更大的感受野，从而获取到高层语义信息***

虽然扩张卷积解决了特征图分辨率和感受野大小之间的矛盾，但是简单地从扩张卷积的特征图中生成语义标签的方法仍然有其局限性。具体而言，扩张卷积特征图中的所有神经元具有相同的感受野大小，这意味着语义标签生成过程仅使用单一尺度的特征。然而，经验[24,2,3]表明，**多尺度信息有助于解决模糊的情况**，并产生更有效的分类。为此，ASPP [2,3]提出连接由不同扩张速率的扩张卷积生成的特征图，以便输出特征图中的神经元包含多个接收场大小，这些大小信息编码多尺度信息并最终提高性能。

**扩张卷积后特征图的神经元具有相同的感受野，具有单一的尺度信息**

但是，ASPP仍然受到另一个限制。具体而言，自动驾驶场景下的输入图像具有高分辨率，这要求神经元具有更大的感受野。为了在ASPP中获得足够大的感受野，必须采用足够大的扩张率。然而，随着扩张率的增加（d>24 扩张卷积变得越来越无效并逐渐失去建模能力[3]。因此，重要的是设计能够编码多尺度信息的网络结构，同时实现足够大的感受野尺寸。

**另一个问题是较大的扩张率产生的特征没啥意思了**

这促使我们提出DenseASPP来解决街道场景中具有挑战性的尺度变化，如图1所示。DenseASPP由基础网络和级联扩张卷积层组成。它使用密集连接将每个扩张卷积层的输出馈送到所有未执行的扩张卷积层，见图2。在DenseASPP中，每个atrous卷积层仅使用具有合理扩张率的扩张滤波器（d<=24）。通过一系列的扩张卷积，后期层的神经元获得越来越大的感受野而不会遭受ASPP中的核退化问题。通过一系列特征连接，每个中间特征映射的神经元编码来自多个尺度的语义信息，不同的中间特征映射编码来自不同尺度范围的多尺度信息。因此，DenseASPP中的最终输出特征图不仅涵盖了大范围内的语义信息，而且还以非常密集的方式覆盖了该范围，见图3。我们对Cityscapes数据集上的DenseASPP进行评估，并获得最先进的性能，IoU得分为80.6％。

**总结：**

1. DenseASPP能够生成覆盖非常大范围的特征；
2. 其生成的特征能够以非常密集的方式覆盖这个大范围。

## 2. 相关工作

由于卷积网络被设计为在整个图像级别进行预测，因此为像素级预测进行了多种修改。完全卷积网络将完全连接的层转换为卷积层，以使分类网能够输出热图[16]。对于多个下采样层，高级特征映射的分辨率具有相当低的分辨率（通常为输入图像的1/32），并且使用双线性上采样或反卷积来恢复分辨率。

为了补偿高级特征的低分辨率，跳层连接[6,1,20]也使用来自中间层或早期层的特征映射。由于低分辨率是由下采样层引起的，DeepLab [14]建议删除最后几个最大池化层并使用atrous卷积。代替添加空洞卷积层来移除池化层，而是更多的扩张卷积层级联堆叠，以进一步增加感受野的大小[3]以覆盖大型物体并带来广泛的背景。

此外，多尺度特征是分割对象的另一个重要因素，其具有各种尺度和模糊像素，需要不同范围的上下文信息。在空间金字塔匹配[13]之后，PSPNet [24]和ASPP [2]被提出用于将多个接收场大小的特征连接在一起以进行最终预测，其中PSPNet并行使用四个空间金字塔池（下采样）层来聚合来自多个的信息接收字段大小并通过上采样分配给每个像素。ASPP连接来自多个扩张卷积层的特征，其具有平行排列的不同扩张率。所提出的DenseASPP结合了并行和级联使用扩张卷积层的优点，并在更大范围内生成更多尺度的特征。

DenseASPP以DenseNet [8]命名，通过将扩张率设置为1，可以将其视为DenseASPP的特例。因此，DenseASPP还具有DenseNet的优点，包括缓解梯度消失问题和显着减少的参数。

## 3.密集连接的空间金字塔

在本节中，我们首先介绍空洞卷积和ASPP的初步知识，然后介绍我们提出的方法。

### 3.1 扩张卷积和金字塔池化

在[14]中首次引入了扩张卷积，以增加感受野，同时保持特征图分辨率不变。在一维情况下，让yi表示输出信号，xi表示输入信号，扩张卷积公式如下：

![gongshi](C:\Users\CV\Documents\GitHub\niecongchong.github.io\img\2019-05-24-2.png)

其中d是膨胀率，w[k]表示滤波器的第k个参数，K是滤波器尺寸。当d=1时，该等式简化为标准卷积。Atrous卷积相当于将输入x与通过在两个连续滤波器值之间插入d-1个零而产生的上采样滤波器进行卷积。因此，大的扩张率意味着大的感受野。

在街景分割中，对象通常具有非常不同的大小。为了处理这种情况，特征图必须能够覆盖不同尺度的感受野。为了实现这一目标，DeepLabV3 [3]提出了两种策略，即具有不同扩张率的几个扩张卷积层的级联和并联。在级联模式中，由于上部的atrous层接受较低的atrous层的输出，它可以有效地产生大的感受野。在并行模式中，由于多个扩张层接受相同的输入并且它们的输出被连接在一起，所以获得的输出是对具有不同接收场尺度的输入的采样。并行模式被正式称为ASPP，它是[2]中Atrous Spatial Pyramid Pooling的缩写。

![aspp](C:\Users\CV\Documents\GitHub\niecongchong.github.io\img\2019-05-24-3.png)

在这项由DenseNets [8]推动的工作中，我们进一步将级联和并行策略的界限推向了一种新颖的架构，这种架构能够生成比[3]更加密集的接收域。Cityscapes [4]数据集的实验结果证明了它的有效性。

### 3.2 密集特征金字塔和更大的感受野

DenseASPP的结构如上图所示。扩张卷积层以级联方式组织，其中每层的扩张速率逐层增加。扩张率小的层放在下部，而扩张率大的层放在上部。每个atrous层的输出与输入特征图和来自较低层的所有输出连接，并且连接的特征图被馈送到下一层。DenseASPP的最终输出是由多扩张率，多尺度的atrous卷积生成的特征映射。所提出的结构可以仅使用少量的扩张卷积层同时构成更密集和更大的特征金字塔。在等式（2）之后，DenseASPP中的每个扩张层可以如下表示：

![denseaspp](C:\Users\CV\Documents\GitHub\niecongchong.github.io\img\2019-05-24-4.png)

这种变化主要带来两个好处：**更密集的特征金字塔和更大的感受野**。我们将在以下两个小节中详细解释我们的网络设计这两个好处。

#### 3.2.1 密集特征金字塔

DenseASPP构成比ASPP中更密集的特征金字塔。“密度更高”这个词不仅意味着特征金字塔的更好的尺度多样性，而且意味着卷积中涉及的像素多于ASPP中的像素（**理解为更密集，不存在漏洞**）。

**更密集的尺度采样：**DenseASPP是一种有效的架构，可以对不同尺度的输入进行采样。DenseASPP的一个关键设计是使用密集连接来实现具有不同扩张速率的各种层的集合。每个集合相当于不同尺度的卷积核，即不同的感受野。因此，我们得到的特征图比ASPP [2]中有更多的尺度。

扩张能够增加卷积核的感受野。对于具有膨胀率d和核尺寸K的扩张卷积层，等效的感受野尺寸为：

![size](C:\Users\CV\Documents\GitHub\niecongchong.github.io\img\2019-05-24-5.png)

例如，对于具有d=3的3x3卷积层，相应的感受野大小为7。

将两个卷积层堆叠在一起可以为我们提供更大的感受野。假设我们有两个卷积层，其滤波器尺寸分别为k1和k2，新的感受野是：

![合并感受野](C:\Users\CV\Documents\GitHub\niecongchong.github.io\img\2019-05-24-6.png)

例如：7x7的卷积核和13x13的卷积核堆叠将会产生19x19的感受野。

下图展现了一个简化的特征金字塔，可以帮助读者更好的理解其尺度多样性。

![金字塔](C:\Users\CV\Documents\GitHub\niecongchong.github.io\img\2019-05-24-7.png)

该DenseASPP的扩张率为3,6,12,18。每个条带中的数字代表不同膨胀率的组合，每个条带的长度代表每种组合的等效卷积核尺寸。很明显，堆叠的扩张卷积层之间的密集连接能够构成具有更密集的尺度多样性的特征金字塔。DenseASPP集合的感受野是ASPP中的超级集合。

**密集像素采样：**与ASPP相比，DenseASPP在特征金字塔的计算中获得了更多的像素。ASPP使用4个扩张卷积层构成特征金字塔，扩张率为6,12,18,24。与相同感受野的传统卷积层相比，具有大扩张率的扩张卷积层的像素采样率非常稀疏。

下图（a）示出了传统的一维扩张卷积层，其扩张率为6.该卷积具有接收场大小13.然而，在这样大的内核中，仅采样3个像素用于计算。这种现象在二维情况下变得更糟。虽然获得了更大的感受野，但在计算过程中丢失了大量信息。

DenseASPP的情况大不相同。在DenseASPP中，扩张率逐层增加，因此，上层中的卷积可以采用来自较低层的特征，并使像素采样更密集。图（b）说明了这个过程：将具有扩张率3的扩张卷积层置于具有扩张率6的层之前。对于扩张率为6的原始扩张卷积层，7个像素的信息将用于最终计算，其比原始的3个像素更密集。在二维情况下，49个像素将用于最终预测，而在标准的单层扩张卷积中，只有9个像素有贡献。当扩张率变大时，这种现象变得更加明显。图4（c）示出了2D版本的现象。具有较大扩张率的卷积层可以从具有较小扩张率的滤波器获得帮助，并以更密集的方式对像素进行采样。

![稀疏与密集](C:\Users\CV\Documents\GitHub\niecongchong.github.io\img\2019-05-24-8.png)

#### 3.2.2 更大的感受野

DenseASPP带来的另一个好处是更大的感受野。在传统的ASPP中，Atrous卷积层并行工作，并且四个子分支在前馈过程中不共享任何信息。相反，DenseASPP中的扩张卷积层通过跳层连接共享信息。扩张率小且扩张率大的层相互依赖地工作，其中前馈过程不仅构成更密集的特征金字塔，而且还产生更大的过滤器来感知更大的上下文信息。

根据上面的等式，ASPP的最大感受野（6,12,18,24）是

![aspp](C:\Users\CV\Documents\GitHub\niecongchong.github.io\img\2019-05-24-9.png)

而DenseASPP（6,12,18,24）的最大感受野是：

![denseaspp](C:\Users\CV\Documents\GitHub\niecongchong.github.io\img\2019-05-24-10.png)

如此大的接收场可以为高分辨率图像中的大对象提供全局信息。例如，Cityscapes [4]的分辨率为2048x1024，我们的分割网络的最后一个特征映射是256x128。DenseASPP（6,12,18,24）的特征映射大小为122，而DenseASPP（3,6,12,18,24）覆盖的特征映射大小为128。

### 3.3 模型尺寸控制

为了控制模型大小并防止网络变得太宽，我们遵循[8]在DenseASPP中的每个扩张卷积层之前添加1x1卷积层，以将要素图的通道数减少到其原始大小的一半。

## 4. 实验

### 4.1 实现细节

#### 4.1.1 DenseASPP——不同深度编码器对比

![baseline](C:\Users\CV\Documents\GitHub\niecongchong.github.io\img\2019-05-24-11.png)

#### 4.1.2 DenseASPP——不同扩张率对比

![a](C:\Users\CV\Documents\GitHub\niecongchong.github.io\img\2019-05-24-12.png)

#### 4.1.3 与其他模型对比

![a](C:\Users\CV\Documents\GitHub\niecongchong.github.io\img\2019-05-24-13.png)